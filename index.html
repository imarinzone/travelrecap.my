<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Travel Recap</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <!-- Tailwind CSS (built via npm run build) -->
    <link rel="stylesheet" href="tailwind.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&display=swap" rel="stylesheet"
        crossorigin="anonymous">
    <!-- Material Icons (crossorigin so html-to-image can capture without SecurityError) -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" crossorigin="anonymous">

    <!-- SEO: meta description for search result snippets -->
    <meta name="description" content="Visualize your Google Timeline data with beautiful interactive maps and stats. 100% private and client-side.">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Your Travel Recap" />
    <meta property="og:description"
        content="Visualize your Google Timeline data with beautiful interactive maps and stats. 100% private and client-side." />
    <meta property="og:type" content="website" />

    <!-- Leaflet CSS (Inlined for file:// compatibility) -->
    <style>
        /* required styles */
        .leaflet-pane,
        .leaflet-tile,
        .leaflet-marker-icon,
        .leaflet-marker-shadow,
        .leaflet-tile-container,
        .leaflet-pane>svg,
        .leaflet-pane>canvas,
        .leaflet-zoom-box,
        .leaflet-image-layer,
        .leaflet-layer {
            position: absolute;
            left: 0;
            top: 0;
        }

        .leaflet-container {
            overflow: hidden;
        }

        .leaflet-tile,
        .leaflet-marker-icon,
        .leaflet-marker-shadow {
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
            -webkit-user-drag: none;
        }

        .leaflet-tile::selection {
            background: transparent;
        }

        .leaflet-safari .leaflet-tile {
            image-rendering: -webkit-optimize-contrast;
        }

        .leaflet-safari .leaflet-tile-container {
            width: 1600px;
            height: 1600px;
            -webkit-transform-origin: 0 0;
        }

        .leaflet-marker-icon,
        .leaflet-marker-shadow {
            display: block;
        }

        .leaflet-container .leaflet-overlay-pane svg {
            max-width: none !important;
            max-height: none !important;
        }

        .leaflet-container .leaflet-marker-pane img,
        .leaflet-container .leaflet-shadow-pane img,
        .leaflet-container .leaflet-tile-pane img,
        .leaflet-container img.leaflet-image-layer,
        .leaflet-container .leaflet-tile {
            max-width: none !important;
            max-height: none !important;
            width: auto;
            padding: 0;
        }

        .leaflet-container img.leaflet-tile {
            mix-blend-mode: plus-lighter;
        }

        .leaflet-container.leaflet-touch-zoom {
            -ms-touch-action: pan-x pan-y;
            touch-action: pan-x pan-y;
        }

        .leaflet-container.leaflet-touch-drag {
            -ms-touch-action: pinch-zoom;
            touch-action: none;
            touch-action: pinch-zoom;
        }

        .leaflet-container.leaflet-touch-drag.leaflet-touch-zoom {
            -ms-touch-action: none;
            touch-action: none;
        }

        .leaflet-container {
            -webkit-tap-highlight-color: transparent;
        }

        .leaflet-container a {
            -webkit-tap-highlight-color: rgba(51, 181, 229, 0.4);
        }

        .leaflet-tile {
            filter: inherit;
            visibility: hidden;
        }

        .leaflet-tile-loaded {
            visibility: inherit;
        }

        .leaflet-zoom-box {
            width: 0;
            height: 0;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            z-index: 800;
        }

        .leaflet-overlay-pane svg {
            -moz-user-select: none;
        }

        .leaflet-pane {
            z-index: 400;
        }

        .leaflet-tile-pane {
            z-index: 200;
        }

        .leaflet-overlay-pane {
            z-index: 400;
        }

        .leaflet-shadow-pane {
            z-index: 500;
        }

        .leaflet-marker-pane {
            z-index: 600;
        }

        .leaflet-tooltip-pane {
            z-index: 650;
        }

        .leaflet-popup-pane {
            z-index: 700;
        }

        .leaflet-map-pane canvas {
            z-index: 100;
        }

        .leaflet-map-pane svg {
            z-index: 200;
        }

        .leaflet-vml-shape {
            width: 1px;
            height: 1px;
        }

        .lvml {
            behavior: url(#default#VML);
            display: inline-block;
            position: absolute;
        }

        .leaflet-control {
            position: relative;
            z-index: 800;
            pointer-events: visiblePainted;
            pointer-events: auto;
        }

        .leaflet-top,
        .leaflet-bottom {
            position: absolute;
            z-index: 1000;
            pointer-events: none;
        }

        .leaflet-top {
            top: 0;
        }

        .leaflet-right {
            right: 0;
        }

        .leaflet-bottom {
            bottom: 0;
        }

        .leaflet-left {
            left: 0;
        }

        .leaflet-control {
            float: left;
            clear: both;
        }

        .leaflet-right .leaflet-control {
            float: right;
        }

        .leaflet-top .leaflet-control {
            margin-top: 10px;
        }

        .leaflet-bottom .leaflet-control {
            margin-bottom: 10px;
        }

        .leaflet-left .leaflet-control {
            margin-left: 10px;
        }

        .leaflet-right .leaflet-control {
            margin-right: 10px;
        }

        .leaflet-fade-anim .leaflet-popup {
            opacity: 0;
            -webkit-transition: opacity 0.2s linear;
            -moz-transition: opacity 0.2s linear;
            transition: opacity 0.2s linear;
        }

        .leaflet-fade-anim .leaflet-map-pane .leaflet-popup {
            opacity: 1;
        }

        .leaflet-zoom-animated {
            -webkit-transform-origin: 0 0;
            -ms-transform-origin: 0 0;
            transform-origin: 0 0;
        }

        svg.leaflet-zoom-animated {
            will-change: transform;
        }

        .leaflet-zoom-anim .leaflet-zoom-animated {
            -webkit-transition: -webkit-transform 0.25s cubic-bezier(0, 0, 0.25, 1);
            -moz-transition: -moz-transform 0.25s cubic-bezier(0, 0, 0.25, 1);
            transition: transform 0.25s cubic-bezier(0, 0, 0.25, 1);
        }

        .leaflet-zoom-anim .leaflet-tile,
        .leaflet-pan-anim .leaflet-tile {
            -webkit-transition: none;
            -moz-transition: none;
            transition: none;
        }

        .leaflet-zoom-anim .leaflet-zoom-hide {
            visibility: hidden;
        }

        .leaflet-interactive {
            cursor: pointer;
        }

        .leaflet-grab {
            cursor: -webkit-grab;
            cursor: -moz-grab;
            cursor: grab;
        }

        .leaflet-crosshair,
        .leaflet-crosshair .leaflet-interactive {
            cursor: crosshair;
        }

        .leaflet-popup-pane,
        .leaflet-control {
            cursor: auto;
        }

        .leaflet-dragging .leaflet-grab,
        .leaflet-dragging .leaflet-grab .leaflet-interactive,
        .leaflet-dragging .leaflet-marker-draggable {
            cursor: move;
            cursor: -webkit-grabbing;
            cursor: -moz-grabbing;
            cursor: grabbing;
        }

        .leaflet-marker-icon,
        .leaflet-marker-shadow,
        .leaflet-image-layer,
        .leaflet-pane>svg path,
        .leaflet-tile-container {
            pointer-events: none;
        }

        .leaflet-marker-icon.leaflet-interactive,
        .leaflet-image-layer.leaflet-interactive,
        .leaflet-pane>svg path.leaflet-interactive,
        svg.leaflet-image-layer.leaflet-interactive path {
            pointer-events: visiblePainted;
            pointer-events: auto;
        }

        .leaflet-container {
            background: #ddd;
            outline-offset: 1px;
        }

        .leaflet-container a {
            color: #0078A8;
        }

        .leaflet-zoom-box {
            border: 2px dotted #38f;
            background: rgba(255, 255, 255, 0.5);
        }

        .leaflet-container {
            font-family: "Helvetica Neue", Arial, Helvetica, sans-serif;
            font-size: 12px;
            font-size: 0.75rem;
            line-height: 1.5;
        }

        .leaflet-bar {
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
            border-radius: 4px;
        }

        .leaflet-bar a {
            background-color: #fff;
            border-bottom: 1px solid #ccc;
            width: 26px;
            height: 26px;
            line-height: 26px;
            display: block;
            text-align: center;
            text-decoration: none;
            color: black;
        }

        .leaflet-bar a,
        .leaflet-control-layers-toggle {
            background-position: 50% 50%;
            background-repeat: no-repeat;
            display: block;
        }

        .leaflet-bar a:hover,
        .leaflet-bar a:focus {
            background-color: #f4f4f4;
        }

        .leaflet-bar a:first-child {
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
        }

        .leaflet-bar a:last-child {
            border-bottom-left-radius: 4px;
            border-bottom-right-radius: 4px;
            border-bottom: none;
        }

        .leaflet-bar a.leaflet-disabled {
            cursor: default;
            background-color: #f4f4f4;
            color: #bbb;
        }

        .leaflet-touch .leaflet-bar a {
            width: 30px;
            height: 30px;
            line-height: 30px;
        }

        .leaflet-touch .leaflet-bar a:first-child {
            border-top-left-radius: 2px;
            border-top-right-radius: 2px;
        }

        .leaflet-touch .leaflet-bar a:last-child {
            border-bottom-left-radius: 2px;
            border-bottom-right-radius: 2px;
        }

        .leaflet-control-zoom-in,
        .leaflet-control-zoom-out {
            font: bold 18px 'Lucida Console', Monaco, monospace;
            text-indent: 1px;
        }

        .leaflet-touch .leaflet-control-zoom-in,
        .leaflet-touch .leaflet-control-zoom-out {
            font-size: 22px;
        }

        .leaflet-control-layers {
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
            background: #fff;
            border-radius: 5px;
        }

        .leaflet-control-layers-toggle {
            width: 36px;
            height: 36px;
        }

        .leaflet-retina .leaflet-control-layers-toggle {
            background-size: 26px 26px;
        }

        .leaflet-touch .leaflet-control-layers-toggle {
            width: 44px;
            height: 44px;
        }

        .leaflet-control-layers .leaflet-control-layers-list,
        .leaflet-control-layers-expanded .leaflet-control-layers-toggle {
            display: none;
        }

        .leaflet-control-layers-expanded .leaflet-control-layers-list {
            display: block;
            position: relative;
        }

        .leaflet-control-layers-expanded {
            padding: 6px 10px 6px 6px;
            color: #333;
            background: #fff;
        }

        .leaflet-control-layers-scrollbar {
            overflow-y: scroll;
            overflow-x: hidden;
            padding-right: 5px;
        }

        .leaflet-control-layers-selector {
            margin-top: 2px;
            position: relative;
            top: 1px;
        }

        .leaflet-control-layers label {
            display: block;
            font-size: 13px;
            font-size: 1.08333em;
        }

        .leaflet-control-layers-separator {
            height: 0;
            border-top: 1px solid #ddd;
            margin: 5px -10px 5px -6px;
        }

        .leaflet-container .leaflet-control-attribution {
            background: #fff;
            background: rgba(255, 255, 255, 0.8);
            margin: 0;
        }

        .leaflet-control-attribution,
        .leaflet-control-scale-line {
            padding: 0 5px;
            color: #333;
            line-height: 1.4;
        }

        .leaflet-control-attribution a {
            text-decoration: none;
        }

        .leaflet-control-attribution a:hover,
        .leaflet-control-attribution a:focus {
            text-decoration: underline;
        }

        .leaflet-attribution-flag {
            display: inline !important;
            vertical-align: baseline !important;
            width: 1em;
            height: 0.6669em;
        }

        .leaflet-left .leaflet-control-scale {
            margin-left: 5px;
        }

        .leaflet-bottom .leaflet-control-scale {
            margin-bottom: 5px;
        }

        .leaflet-control-scale-line {
            border: 2px solid #777;
            border-top: none;
            line-height: 1.1;
            padding: 2px 5px 1px;
            white-space: nowrap;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            background: rgba(255, 255, 255, 0.8);
            text-shadow: 1px 1px #fff;
        }

        .leaflet-control-scale-line:not(:first-child) {
            border-top: 2px solid #777;
            border-bottom: none;
            margin-top: -2px;
        }

        .leaflet-control-scale-line:not(:first-child):not(:last-child) {
            border-bottom: 2px solid #777;
        }

        .leaflet-touch .leaflet-control-attribution,
        .leaflet-touch .leaflet-control-layers,
        .leaflet-touch .leaflet-bar {
            box-shadow: none;
        }

        .leaflet-touch .leaflet-control-layers,
        .leaflet-touch .leaflet-bar {
            border: 2px solid rgba(0, 0, 0, 0.2);
            background-clip: padding-box;
        }

        .leaflet-popup {
            position: absolute;
            text-align: center;
            margin-bottom: 20px;
        }

        .leaflet-popup-content-wrapper {
            padding: 1px;
            text-align: left;
            border-radius: 12px;
        }

        .leaflet-popup-content {
            margin: 13px 24px 13px 20px;
            line-height: 1.3;
            font-size: 13px;
            font-size: 1.08333em;
            min-height: 1px;
        }

        .leaflet-popup-content p {
            margin: 17px 0;
            margin: 1.3em 0;
        }

        .leaflet-popup-tip-container {
            width: 40px;
            height: 20px;
            position: absolute;
            left: 50%;
            margin-top: -1px;
            margin-left: -20px;
            overflow: hidden;
            pointer-events: none;
        }

        .leaflet-popup-tip {
            width: 17px;
            height: 17px;
            padding: 1px;

            margin: -10px auto 0;
            pointer-events: auto;

            -webkit-transform: rotate(45deg);
            -moz-transform: rotate(45deg);
            -ms-transform: rotate(45deg);
            transform: rotate(45deg);
        }

        .leaflet-popup-content-wrapper,
        .leaflet-popup-tip {
            background: white;
            color: #333;
            box-shadow: 0 3px 14px rgba(0, 0, 0, 0.4);
        }

        .leaflet-container a.leaflet-popup-close-button {
            position: absolute;
            top: 0;
            right: 0;
            border: none;
            text-align: center;
            width: 24px;
            height: 24px;
            font: 16px/24px Tahoma, Verdana, sans-serif;
            color: #757575;
            text-decoration: none;
            background: transparent;
        }

        .leaflet-container a.leaflet-popup-close-button:hover,
        .leaflet-container a.leaflet-popup-close-button:focus {
            color: #585858;
        }

        .leaflet-popup-scrolled {
            overflow: auto;
        }

        .leaflet-oldie .leaflet-popup-content-wrapper {
            -ms-zoom: 1;
        }

        .leaflet-oldie .leaflet-popup-tip {
            width: 24px;
            margin: 0 auto;
            -ms-filter: "progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678)";
            filter: progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678);
        }

        .leaflet-oldie .leaflet-control-zoom,
        .leaflet-oldie .leaflet-control-layers,
        .leaflet-oldie .leaflet-popup-content-wrapper,
        .leaflet-oldie .leaflet-popup-tip {
            border: 1px solid #999;
        }

        .leaflet-div-icon {
            background: #fff;
            border: 1px solid #666;
        }

        .leaflet-tooltip {
            position: absolute;
            padding: 6px;
            background-color: #fff;
            border: 1px solid #fff;
            border-radius: 3px;
            color: #222;
            white-space: nowrap;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            pointer-events: none;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }

        .leaflet-tooltip.leaflet-interactive {
            cursor: pointer;
            pointer-events: auto;
        }

        .leaflet-tooltip-top:before,
        .leaflet-tooltip-bottom:before,
        .leaflet-tooltip-left:before,
        .leaflet-tooltip-right:before {
            position: absolute;
            pointer-events: none;
            border: 6px solid transparent;
            background: transparent;
            content: "";
        }

        .leaflet-tooltip-bottom {
            margin-top: 6px;
        }

        .leaflet-tooltip-top {
            margin-top: -6px;
        }

        .leaflet-tooltip-bottom:before,
        .leaflet-tooltip-top:before {
            left: 50%;
            margin-left: -6px;
        }

        .leaflet-tooltip-top:before {
            bottom: 0;
            margin-bottom: -12px;
            border-top-color: #fff;
        }

        .leaflet-tooltip-bottom:before {
            top: 0;
            margin-top: -12px;
            margin-left: -6px;
            border-bottom-color: #fff;
        }

        .leaflet-tooltip-left {
            margin-left: -6px;
        }

        .leaflet-tooltip-right {
            margin-left: 6px;
        }

        .leaflet-tooltip-left:before,
        .leaflet-tooltip-right:before {
            top: 50%;
            margin-top: -6px;
        }

        .leaflet-tooltip-left:before {
            right: 0;
            margin-right: -12px;
            border-left-color: #fff;
        }

        .leaflet-tooltip-right:before {
            left: 0;
            margin-left: -12px;
            border-right-color: #fff;
        }
    </style>
    <style>
        :root {
            --color-blue-500: #3b82f6;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            min-height: 100vh;
            color: #1e293b;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Dark mode body */
        body.dark {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
        }

        /* Glassmorphism utility */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        body.dark .glass {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-dark {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Dark mode text colors */
        body.dark .text-gray-900 { color: #f1f5f9; }
        body.dark .text-gray-800 { color: #e2e8f0; }
        body.dark .text-gray-700 { color: #cbd5e1; }
        body.dark .text-gray-600 { color: #94a3b8; }
        body.dark .text-gray-500 { color: #64748b; }
        
        /* Dark mode backgrounds */
        body.dark .bg-white { background-color: #1e293b; }
        body.dark .bg-gray-50 { background-color: #1e293b; }
        body.dark .bg-gray-100 { background-color: #334155; }
        body.dark .bg-gray-200 { background-color: #475569; }
        
        /* Modern Timeline Selector Styles */
        .timeline-modern-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
        }
        
        .timeline-modern-container {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px;
            background: rgba(241, 245, 249, 0.8);
            border-radius: 9999px;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(226, 232, 240, 0.5);
            overflow-x: auto;
            max-width: 100%;
            -ms-overflow-style: none;
            scrollbar-width: none;
            position: relative;
        }
        
        .timeline-modern-container::-webkit-scrollbar {
            display: none;
        }
        
        body.dark .timeline-modern-container {
            background: rgba(30, 41, 59, 0.8);
            border-color: rgba(51, 65, 85, 0.5);
        }

        /* Taskbar (Mac-inspired) */
        #top-control-bar {
            background: transparent;
            border: none;
            box-shadow: none;
        }

        .taskbar-shell {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 10px 0;
        }

        .taskbar {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 14px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.35);
            border: 1px solid rgba(255, 255, 255, 0.35);
            box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(22px) saturate(1.1);
            -webkit-backdrop-filter: blur(22px) saturate(1.1);
            max-width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .taskbar::-webkit-scrollbar {
            display: none;
        }

        body.dark .taskbar {
            background: rgba(15, 23, 42, 0.35);
            border-color: rgba(148, 163, 184, 0.12);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.04);
        }

        /* Year timeline bar: pill only as wide as year content; spacers let any year scroll to center */
        #year-timeline-bar .taskbar-shell {
            pointer-events: auto;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            justify-content: flex-start;
            padding: 10px 0;
            max-width: 100%;
            scroll-snap-type: x mandatory;
            scroll-padding-inline: 50%;
        }

        #year-timeline-bar .taskbar-shell::-webkit-scrollbar {
            display: none;
        }

        .year-timeline-scroll-wrapper {
            display: flex;
            flex-shrink: 0;
            width: max-content;
            align-items: center;
        }

        .year-timeline-spacer {
            flex: 0 0 calc(50vw - 3rem);
            min-width: 0;
            pointer-events: none;
        }

        #year-timeline-bar .taskbar {
            flex-shrink: 0;
            width: max-content;
            min-height: 0;
            max-width: none;
            overflow: visible;
            justify-content: flex-start;
            /* Same padding as bottom taskbar â€“ pill only as wide as years + this padding */
            padding: 8px 14px;
            /* Same glass as bottom taskbar */
            background: rgba(255, 255, 255, 0.35);
            border: 1px solid rgba(255, 255, 255, 0.35);
            box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(22px) saturate(1.1);
            -webkit-backdrop-filter: blur(22px) saturate(1.1);
        }

        body.dark #year-timeline-bar .taskbar {
            background: rgba(15, 23, 42, 0.35);
            border-color: rgba(148, 163, 184, 0.12);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.04);
        }

        /* Snap each year to center when scrolling */
        #year-timeline-bar .timeline-year-btn {
            scroll-snap-align: center;
        }

        .taskbar-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .taskbar-divider {
            width: 1px;
            height: 24px;
            background: rgba(148, 163, 184, 0.35);
        }

        body.dark .taskbar-divider {
            background: rgba(148, 163, 184, 0.2);
        }

        .taskbar-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: #64748b;
            font-weight: 600;
        }

        body.dark .taskbar-label {
            color: #94a3b8;
        }

        /* Tighten controls inside taskbar */
        .taskbar .timeline-modern-container {
            background: transparent;
            border: none;
            box-shadow: none;
            padding: 0;
        }

        .taskbar .timeline-modern-wrapper {
            justify-content: flex-start;
        }

        .taskbar .timeline-year-btn,
        .taskbar .timeline-year-point,
        .taskbar .timeline-all-years {
            padding: 6px 12px;
        }

        .taskbar .theme-toggle {
            background: rgba(226, 232, 240, 0.6);
            border-radius: 999px;
            padding: 2px;
        }

        body.dark .taskbar .theme-toggle {
            background: rgba(30, 41, 59, 0.6);
        }

        /* Theme toggle switch */
        .theme-switch {
            position: relative;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px;
            border-radius: 999px;
            background: rgba(226, 232, 240, 0.6);
            width: 84px;
            height: 36px;
        }

        body.dark .theme-switch {
            background: rgba(30, 41, 59, 0.6);
        }

        .theme-switch-btn {
            position: relative;
            z-index: 2;
            width: 36px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 999px;
            color: #64748b;
            transition: color 0.2s ease;
        }

        body.dark .theme-switch-btn {
            color: #94a3b8;
        }

        .theme-switch-btn.active {
            color: #f59e0b;
        }

        body.dark .theme-switch-btn.active {
            color: #f8fafc;
        }

        #theme-light.active {
            color: #facc15 !important;
        }

        .theme-switch-knob {
            position: absolute;
            top: 4px;
            left: 4px;
            width: 36px;
            height: 28px;
            border-radius: 999px;
            background: rgba(30, 41, 59, 0.9);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
            transition: transform 0.25s ease, background 0.25s ease;
            z-index: 1;
        }

        /* Knob position by active button (light = left, dark = right) */
        .theme-switch:has(#theme-light.active) .theme-switch-knob {
            transform: translateX(0);
        }
        .theme-switch:has(#theme-dark.active) .theme-switch-knob {
            transform: translateX(40px);
        }

        /* Place details opt-in toggle (homepage, subtle) */
        .place-details-toggle[aria-checked="true"] {
            background-color: var(--color-blue-500);
        }
        body.dark .place-details-toggle[aria-checked="true"] {
            background-color: var(--color-blue-500);
        }
        .place-details-toggle[aria-checked="true"] .place-details-toggle-dot {
            transform: translate(1rem, 0);
        }

        /* Summary globe styling */
        #summary-globe-container svg {
            width: 100%;
            height: 100%;
            opacity: 0.8;
        }

        /* All-time lifetime stats text (now inline above globe) - aligned with travel-summary-card */
        .all-time-foreground-text {
            max-width: 56rem;
            margin: 4rem auto 0;
            padding: 0 1rem;
            text-align: left;
        }
        
        /* Timeline year button styles (modern pill) */
        .timeline-year-btn {
            padding: 6px 14px;
            font-size: 13px;
            font-weight: 500;
            color: #64748b;
            background: transparent;
            border: none;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        body.dark .timeline-year-btn {
            color: #94a3b8;
        }
        
        .timeline-year-btn:hover {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        
        body.dark .timeline-year-btn:hover {
            color: #60a5fa;
            background: rgba(59, 130, 246, 0.15);
        }
        
        .timeline-year-btn.active {
            color: #1e293b;
            background: transparent;
            box-shadow: none;
        }

        body.dark .timeline-year-btn.active {
            color: #ffffff;
            background: transparent;
            box-shadow: none;
        }
        
        /* Legacy classes for backward compatibility - style same as modern buttons */
        .timeline-year-point,
        .timeline-all-years {
            padding: 6px 14px;
            font-size: 13px;
            font-weight: 500;
            color: #64748b;
            background: transparent;
            border: none;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        body.dark .timeline-year-point,
        body.dark .timeline-all-years {
            color: #94a3b8;
        }
        
        .timeline-year-point:hover,
        .timeline-all-years:hover {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        
        .timeline-year-point.active,
        .timeline-all-years.active {
            color: #1e293b;
            background: transparent;
            box-shadow: none;
        }

        body.dark .timeline-year-point.active,
        body.dark .timeline-all-years.active {
            color: #ffffff;
        }

        .glow-blue-btn {
            background: #3b82f6;
            color: #ffffff;
            border-color: rgba(59, 130, 246, 0.65);
            box-shadow: 0 10px 22px rgba(59, 130, 246, 0.45);
        }

        .glow-blue-btn:hover {
            background: #2563eb;
            border-color: rgba(37, 99, 235, 0.7);
        }

        /* Timeline switch knob (like theme toggle) */
        .timeline-switch-knob {
            position: absolute;
            top: 4px;
            bottom: 4px;
            left: 4px;
            border-radius: 999px;
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.35);
            transition: transform 0.25s ease, width 0.25s ease;
            z-index: 0;
        }

        body.dark .timeline-switch-knob {
            box-shadow: 0 6px 14px rgba(59, 130, 246, 0.3);
        }

        .timeline-modern-container .timeline-year-btn,
        .timeline-modern-container .timeline-year-point,
        .timeline-modern-container .timeline-all-years {
            position: relative;
            z-index: 1;
        }
        
        /* Remove old label styling */
        .timeline-year-label {
            display: none;
        }

        /* Hide scrollbar for clean horizontal scroll */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Map specific overrides */
        #map {
            z-index: 10;
        }

        /* Keep map overlay clear of taskbar */
        #map-overlay {
            padding-bottom: 96px;
        }

        #map-overlay .map-overlay-card {
            height: calc(100% - 96px);
        }
        
        /* ===== AESTHETIC MAP MARKERS ===== */
        .custom-point-marker {
            background: transparent !important;
            border: none !important;
        }
        
        .map-marker-dot {
            position: relative;
            width: 20px;
            height: 20px;
        }
        
        .map-marker-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 50%, #2563eb 100%);
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 
                0 2px 8px rgba(59, 130, 246, 0.65),
                0 0 0 1px rgba(59, 130, 246, 0.25),
                0 1px 3px rgba(0, 0, 0, 0.15);
            transition: all 0.2s ease;
        }
        
        .map-marker-dot:hover .map-marker-inner {
            transform: translate(-50%, -50%) scale(1.3);
            box-shadow: 
                0 4px 14px rgba(59, 130, 246, 0.7),
                0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .map-marker-pulse {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            animation: marker-pulse 2s ease-out infinite;
            pointer-events: none;
        }
        
        @keyframes marker-pulse {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.5;
            }
            100% {
                transform: translate(-50%, -50%) scale(3.5);
                opacity: 0;
            }
        }
        
        /* Dark mode markers */
        body.dark .map-marker-inner {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 50%, #2563eb 100%);
            border-color: #1e293b;
            box-shadow: 
                0 2px 8px rgba(96, 165, 250, 0.5),
                0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        body.dark .map-marker-pulse {
            background: rgba(96, 165, 250, 0.3);
        }
        
        /* Leaflet popup styling */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        body.dark .leaflet-popup-content-wrapper {
            background: #1e293b;
            color: #e2e8f0;
        }
        
        body.dark .leaflet-popup-tip {
            background: #1e293b;
        }
        
        /* Hide zoom (+/-) and attribution when capturing map for share image */
        #map-container-wrapper.share-capture .leaflet-control-zoom,
        #map-container-wrapper.share-capture .leaflet-control-attribution {
            display: none !important;
        }

        /* Equator/tropics: hidden on globe; shown only when capturing share image */
        .globe-parallels-share-only {
            visibility: hidden;
        }
        #globe-container.share-capture .globe-parallels-share-only {
            visibility: visible;
        }
        
        /* Globe theme styles */
        .globe-svg {
            filter: drop-shadow(0 0 40px rgba(59, 130, 246, 0.15));
            transition: filter 0.3s ease;
        }
        
        body.dark .globe-svg {
            filter: drop-shadow(0 0 50px rgba(56, 189, 248, 0.2));
        }

        /* ===== ANIMATED STAT SCENE KEYFRAMES ===== */

        /* Plane flying diagonally across */
        @keyframes plane-glide {
            0% {
                transform: translate(-20%, 80%) rotate(-25deg) scale(0.8);
                opacity: 0;
            }

            10% {
                opacity: 1;
            }

            90% {
                opacity: 1;
            }

            100% {
                transform: translate(120%, -20%) rotate(-25deg) scale(1);
                opacity: 0;
            }
        }

        /* Car driving horizontally */
        @keyframes car-drive {
            0% {
                transform: translateX(-30%);
            }

            100% {
                transform: translateX(130%);
            }
        }

        /* Train moving horizontally */
        @keyframes train-drive {
            0% {
                transform: translateX(-40%);
            }

            100% {
                transform: translateX(140%);
            }
        }

        /* Walking human step cycle */
        @keyframes walk-cycle {

            0%,
            100% {
                transform: translateX(-20%) translateY(0);
            }

            25% {
                transform: translateX(10%) translateY(-3px);
            }

            50% {
                transform: translateX(40%) translateY(0);
            }

            75% {
                transform: translateX(70%) translateY(-3px);
            }
        }

        /* Cycling animation */
        @keyframes bike-ride {
            0% {
                transform: translateX(-25%) rotate(0deg);
            }

            50% {
                transform: translateX(50%) rotate(2deg);
            }

            100% {
                transform: translateX(125%) rotate(0deg);
            }
        }

        /* City skyline breathing/bobbing */
        @keyframes city-breathe {

            0%,
            100% {
                transform: translateY(0) scale(1);
            }

            50% {
                transform: translateY(-3px) scale(1.02);
            }
        }

        /* Building window lights twinkling */
        @keyframes window-twinkle {

            0%,
            100% {
                opacity: 0.3;
            }

            50% {
                opacity: 1;
            }
        }

        /* Tree growing from ground */
        @keyframes tree-grow {
            0% {
                transform: scaleY(0) translateY(100%);
                opacity: 0;
            }

            60% {
                transform: scaleY(1.1) translateY(0);
                opacity: 1;
            }

            100% {
                transform: scaleY(1) translateY(0);
                opacity: 1;
            }
        }

        /* Tree swaying gently */
        @keyframes tree-sway {

            0%,
            100% {
                transform: rotate(-2deg);
            }

            50% {
                transform: rotate(2deg);
            }
        }

        /* Factory smoke puffs */
        @keyframes smoke-puff {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0.8;
            }

            100% {
                transform: translateY(-30px) scale(1.5);
                opacity: 0;
            }
        }

        /* Character breathing (sitting/idle) */
        @keyframes character-breathe {

            0%,
            100% {
                transform: scale(1) translateY(0);
            }

            50% {
                transform: scale(1.02) translateY(-2px);
            }
        }

        /* Globe-inspired orbital float */
        @keyframes orbital-float {
            0% {
                transform: translate(0, 0) scale(1);
            }

            25% {
                transform: translate(5px, -5px) scale(1.02);
            }

            50% {
                transform: translate(0, -8px) scale(1);
            }

            75% {
                transform: translate(-5px, -5px) scale(1.02);
            }

            100% {
                transform: translate(0, 0) scale(1);
            }
        }

        /* Pin drop animation for places */
        @keyframes pin-drop {
            0% {
                transform: translateY(-50px) scale(0.5);
                opacity: 0;
            }

            60% {
                transform: translateY(5px) scale(1.1);
                opacity: 1;
            }

            80% {
                transform: translateY(-3px) scale(0.95);
            }

            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        /* Scene fade-in from background */
        @keyframes scene-emerge {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Road/path dashes moving */
        @keyframes road-dash {
            0% {
                stroke-dashoffset: 0;
            }

            100% {
                stroke-dashoffset: -40;
            }
        }

        /* ===== ANIMATION UTILITY CLASSES ===== */
        .animate-plane-glide {
            animation: plane-glide 8s ease-in-out infinite;
        }

        .animate-car-drive {
            animation: car-drive 6s linear infinite;
        }

        .animate-train-drive {
            animation: train-drive 5s linear infinite;
        }

        .animate-walk-cycle {
            animation: walk-cycle 4s ease-in-out infinite;
        }

        .animate-bike-ride {
            animation: bike-ride 5s ease-in-out infinite;
        }

        .animate-city-breathe {
            animation: city-breathe 4s ease-in-out infinite;
        }

        .animate-window-twinkle {
            animation: window-twinkle 2s ease-in-out infinite;
        }

        .animate-tree-grow {
            animation: tree-grow 2s ease-out forwards;
            transform-origin: bottom center;
        }

        .animate-tree-sway {
            animation: tree-sway 3s ease-in-out infinite;
            transform-origin: bottom center;
        }

        .animate-smoke-puff {
            animation: smoke-puff 3s ease-out infinite;
        }

        .animate-character-breathe {
            animation: character-breathe 3s ease-in-out infinite;
        }

        .animate-orbital-float {
            animation: orbital-float 6s ease-in-out infinite;
        }

        .animate-pin-drop {
            animation: pin-drop 0.8s ease-out forwards;
        }

        .animate-scene-emerge {
            animation: scene-emerge 0.6s ease-out forwards;
        }

        .animate-road-dash {
            animation: road-dash 1s linear infinite;
        }

        /* Staggered animation delays */
        .animation-delay-100 {
            animation-delay: 100ms;
        }

        .animation-delay-200 {
            animation-delay: 200ms;
        }

        .animation-delay-300 {
            animation-delay: 300ms;
        }

        .animation-delay-500 {
            animation-delay: 500ms;
        }

        .animation-delay-700 {
            animation-delay: 700ms;
        }

        .animation-delay-1000 {
            animation-delay: 1000ms;
        }

        /* Stat scene container styles */
        .stat-scene {
            position: relative;
            overflow: hidden;
            border-radius: 1rem;
            min-height: 140px;
            perspective: 1000px;
        }

        .stat-scene-layer {
            position: absolute;
            inset: 0;
            pointer-events: none;
        }

        .stat-scene-content {
            position: relative;
            z-index: 10;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            height: 100%;
        }

        /* ===== BACKGROUND INFOGRAPHIC ===== */
        
        #bg-infographic {
            transition: opacity 0.5s ease;
        }
        
        /* Hide bg when map/globe is in fullscreen or focused */
        #map-container-wrapper.fullscreen ~ #bg-infographic,
        body.map-focused #bg-infographic {
            opacity: 0 !important;
        }

        /* ===== TYPOGRAPHY-FIRST STORYTELLING STYLES ===== */
        
        .story-section {
            position: relative;
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        
        .story-headline {
            letter-spacing: -0.03em;
            line-height: 1.1;
        }
        
        /* Enhanced scroll-triggered fade animation for text */
        @keyframes text-fade-up {
            0% {
                opacity: 0;
                transform: translateY(40px) scale(0.96);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .story-section.animate-scene-emerge {
            animation: text-fade-up 0.9s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        
        /* Gradient text for emphasis */
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        body.dark .gradient-text {
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Globe to Map Reveal Animation */
        #globe-map-reveal {
            background: transparent;
        }
        
        /* Transport stat card */
        .transport-stat-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .transport-stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        }
        
        body.dark .transport-stat-card {
            background: rgba(30, 41, 59, 0.6);
            border-color: rgba(51, 65, 85, 0.3);
        }
        
        .transport-stat-card .transport-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .transport-stat-card .transport-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #1e293b;
        }
        
        body.dark .transport-stat-card .transport-value {
            color: #f1f5f9;
        }
        
        .transport-stat-card .transport-label {
            font-size: 0.75rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 0.25rem;
        }
        
        body.dark .transport-stat-card .transport-label {
            color: #94a3b8;
        }
        
        .transport-stat-card .transport-sublabel {
            font-size: 0.7rem;
            color: #94a3b8;
            margin-top: 0.5rem;
        }
        
        /* Place stat card */
        .place-stat-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 1rem;
            padding: 1.25rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            text-align: left;
            transition: all 0.3s ease;
        }
        
        .place-stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        body.dark .place-stat-card {
            background: rgba(30, 41, 59, 0.6);
            border-color: rgba(51, 65, 85, 0.3);
        }
        
        .place-stat-card .place-name {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        body.dark .place-stat-card .place-name {
            color: #f1f5f9;
        }
        
        .place-stat-card .place-count {
            font-size: 1.5rem;
            font-weight: 800;
            color: #6366f1;
            min-width: 50px;
            text-align: right;
        }
        
        body.dark .place-stat-card .place-count {
            color: #818cf8;
        }
        
        .place-stat-card .place-count-label {
            font-size: 0.65rem;
            color: #94a3b8;
            text-transform: uppercase;
        }

        /* ===== REDUCED MOTION SUPPORT ===== */
        @media (prefers-reduced-motion: reduce) {

            .animate-plane-glide,
            .animate-car-drive,
            .animate-train-drive,
            .animate-walk-cycle,
            .animate-bike-ride,
            .animate-city-breathe,
            .animate-window-twinkle,
            .animate-tree-grow,
            .animate-tree-sway,
            .animate-smoke-puff,
            .animate-character-breathe,
            .animate-orbital-float,
            .animate-pin-drop,
            .animate-scene-emerge,
            .animate-road-dash,
            .story-section.animate-scene-emerge {
                animation: none !important;
                transform: none !important;
                opacity: 1 !important;
            }
        }
    </style>
</head>

<body class="text-gray-800 antialiased selection:bg-blue-100 selection:text-blue-900 transition-colors duration-300" id="app-body">

    <!-- ===== VECTOR BACKGROUND INFOGRAPHIC ===== -->
    <div id="bg-infographic" class="fixed inset-0 pointer-events-none z-0 overflow-hidden opacity-[0.04] dark:opacity-[0.06]">
        <!-- Globe lines / meridians -->
        <svg class="absolute w-[800px] h-[800px] -top-40 -right-40 text-blue-500 dark:text-blue-400" viewBox="0 0 400 400" fill="none" stroke="currentColor" stroke-width="0.5">
            <circle cx="200" cy="200" r="180" />
            <circle cx="200" cy="200" r="140" />
            <circle cx="200" cy="200" r="100" />
            <ellipse cx="200" cy="200" rx="180" ry="60" />
            <ellipse cx="200" cy="200" rx="180" ry="120" />
            <line x1="200" y1="20" x2="200" y2="380" />
            <line x1="20" y1="200" x2="380" y2="200" />
            <path d="M 80 80 Q 200 150 320 80" />
            <path d="M 80 320 Q 200 250 320 320" />
        </svg>
        
        <!-- Abstract path / journey lines -->
        <svg class="absolute w-[600px] h-[600px] top-1/3 -left-32 text-indigo-400 dark:text-indigo-500" viewBox="0 0 300 300" fill="none" stroke="currentColor" stroke-width="0.5">
            <path d="M 20 150 Q 80 50 150 150 T 280 150" />
            <path d="M 20 180 Q 100 100 180 180 T 280 180" />
            <circle cx="50" cy="150" r="8" fill="currentColor" opacity="0.3" />
            <circle cx="150" cy="150" r="5" fill="currentColor" opacity="0.3" />
            <circle cx="250" cy="150" r="10" fill="currentColor" opacity="0.3" />
        </svg>
        
        <!-- Dotted trail pattern -->
        <svg class="absolute w-[500px] h-[500px] bottom-20 right-10 text-purple-400 dark:text-purple-500" viewBox="0 0 250 250" fill="currentColor">
            <circle cx="30" cy="50" r="3" opacity="0.4" />
            <circle cx="60" cy="80" r="2" opacity="0.3" />
            <circle cx="100" cy="70" r="4" opacity="0.5" />
            <circle cx="140" cy="100" r="2" opacity="0.3" />
            <circle cx="180" cy="90" r="3" opacity="0.4" />
            <circle cx="210" cy="120" r="2" opacity="0.3" />
            <circle cx="50" cy="150" r="2" opacity="0.3" />
            <circle cx="90" cy="170" r="3" opacity="0.4" />
            <circle cx="130" cy="160" r="2" opacity="0.3" />
            <circle cx="170" cy="190" r="4" opacity="0.5" />
            <circle cx="200" cy="180" r="2" opacity="0.3" />
            <circle cx="220" cy="210" r="3" opacity="0.4" />
        </svg>
        
        <!-- Compass rose hint -->
        <svg class="absolute w-[300px] h-[300px] top-2/3 left-1/4 text-gray-500 dark:text-gray-400" viewBox="0 0 150 150" fill="none" stroke="currentColor" stroke-width="0.5">
            <circle cx="75" cy="75" r="50" />
            <line x1="75" y1="20" x2="75" y2="130" />
            <line x1="20" y1="75" x2="130" y2="75" />
            <polygon points="75,35 80,55 70,55" fill="currentColor" opacity="0.5" />
        </svg>
    </div>

    <!-- Top Control Bar (Taskbar Style) -->
    <div id="top-control-bar" class="fixed bottom-8 left-0 right-0 z-[300] transition-colors duration-300">
        <div class="taskbar-shell">
            <div class="taskbar">
                <!-- Move to top -->
                <div class="taskbar-section">
                    <button id="taskbar-top"
                        class="glow-blue-btn inline-flex items-center justify-center px-3 py-2 rounded-full shadow-sm border transition-colors"
                        aria-label="Back to top">
                        <span class="material-icons-round text-sm">north</span>
                    </button>
                </div>

                <span class="taskbar-divider hidden sm:inline"></span>

                <!-- Theme Toggle -->
                <div class="taskbar-section">
                    <div class="theme-switch" id="theme-switch" role="group" aria-label="Theme toggle">
                        <button id="theme-light" class="theme-switch-btn" title="Light globe & map" aria-pressed="false">
                            <span class="material-icons-round text-base">light_mode</span>
                        </button>
                        <button id="theme-dark" class="theme-switch-btn active" title="Dark globe & map" aria-pressed="true">
                            <span class="material-icons-round text-base">dark_mode</span>
                        </button>
                        <span class="theme-switch-knob" aria-hidden="true"></span>
                    </div>
                </div>

                <span class="taskbar-divider hidden sm:inline"></span>

                <!-- Share button -->
                <div class="taskbar-section">
                    <button id="taskbar-share"
                        class="glow-blue-btn hidden inline-flex items-center justify-center px-3 py-2 rounded-full shadow-sm border transition-colors"
                        aria-label="Share">
                        <span class="material-icons-round text-sm">share</span>
                    </button>
                </div>

                <span class="taskbar-divider hidden sm:inline"></span>

                <!-- Restart -->
                <div class="taskbar-section">
                    <button id="restart-button"
                        class="glow-blue-btn hidden inline-flex items-center justify-center px-3 py-2 rounded-full shadow-sm border transition-colors"
                        aria-label="Start again">
                        <span class="material-icons-round text-sm">restart_alt</span>
                    </button>
                </div>

            </div>
        </div>
    </div>

    <!-- Persistent footer below taskbar -->
    <div class="fixed bottom-0 left-0 right-0 z-[290] pointer-events-none">
        <p class="text-center text-gray-600 dark:text-gray-400 text-xs pb-1 flex items-center justify-center gap-1 flex-wrap">
            <span class="pointer-events-auto">Built in India with â¤ï¸ by
                <a href="https://github.com/imarinzone"
                    class="underline hover:text-gray-600 dark:hover:text-gray-300">@imarinzone</a>
            </span>
            <span class="pointer-events-auto text-gray-600 dark:text-gray-400">Â·</span>
            <span class="pointer-events-auto">
                <a href="https://buymeacoffee.com/imarinzone" target="_blank" rel="noopener noreferrer"
                    class="inline-flex items-center text-gray-600 dark:text-gray-400 hover:text-amber-500 dark:hover:text-amber-400 transition-colors"
                    title="Buy me a coffee">
                    <span class="material-icons-round text-base" aria-hidden="true">local_cafe</span>
                </a>
            </span>
        </p>
    </div>

    <!-- Top Year Timeline Bar (hidden until data is processed) -->
    <div id="year-timeline-bar" class="fixed top-4 left-0 right-0 z-[300] pointer-events-none hidden">
        <div class="taskbar-shell pointer-events-auto" id="year-timeline-shell">
            <div id="year-timeline-scroll-wrapper" class="year-timeline-scroll-wrapper">
                <span class="year-timeline-spacer" aria-hidden="true"></span>
                <div class="taskbar pointer-events-auto">
                    <!-- Timeline Year Selector (Centered, top-only) -->
                    <div id="timeline-selector-container" class="hidden taskbar-section">
                        <div class="timeline-modern-wrapper">
                            <div id="timeline-years" class="timeline-modern-container">
                                <!-- Year buttons will be dynamically added here -->
                            </div>
                        </div>
                    </div>
                </div>
                <span class="year-timeline-spacer" aria-hidden="true"></span>
            </div>
        </div>
    </div>

    <!-- Background Globe (visible on landing page, same position as main globe) -->
    <div id="bg-globe-container"
        class="fixed top-20 left-0 w-[500px] h-[500px] z-0 opacity-30 pointer-events-none transition-opacity duration-1000">
    </div>
    
    <!-- Main Globe (shown after file parsing with visited countries) -->
    <div id="globe-container"
        class="fixed top-20 left-0 w-[500px] h-[500px] z-0 opacity-0 transition-opacity duration-1000">
    </div>

    <main id="main-content" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-10 relative z-10">

        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400 mb-3"
                id="header-title">
                My Travel Recap
            </h1>
            <p class="text-lg text-slate-600 dark:text-gray-300 font-light max-w-2xl mx-auto" id="header-description">
                Remember those cozy year-in-review emails from Google Maps? They quietly vanished when your location history moved onto your device. This little site brings that feeling back â€” your file stays on your machine, and everything is crunched right in your browser.
            </p>
        </header>

        <!-- Initial Upload Section -->
        <section id="upload-section" class="max-w-xl mx-auto mb-16">
            <div
                class="glass rounded-3xl p-8 shadow-xl text-center transform hover:scale-[1.01] transition-all duration-300">
                <div
                    class="mb-6 inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-3">Load Your Data</h2>
                <p class="text-sm text-gray-600 dark:text-gray-300 mb-6">
                    Upload your
                    <code
                        class="bg-gray-100 dark:bg-gray-700 px-1 py-0.5 rounded cursor-pointer underline decoration-dotted underline-offset-2"
                        onclick="document.getElementById('how-to-timeline')?.scrollIntoView({ behavior: 'smooth', block: 'start' });"
                        title="Click to see how to get this file">
                        timeline.json
                    </code>.
                    <br>Your data remains 100% private and processed on device.
                </p>

                <!-- Opt-in: fetch place details from Google (privacy-first, off by default) -->
                <div class="flex items-center justify-center gap-2 mb-6">
                    <label for="place-details-opt-in" class="text-xs text-gray-500 dark:text-gray-400 cursor-pointer select-none">
                        Fetch place details from Google (opt-in)
                    </label>
                    <button type="button" id="place-details-opt-in" role="switch" aria-checked="false" aria-label="Use Google to fetch place details for favorite spots"
                        class="place-details-toggle relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer items-center rounded-full border border-transparent transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 bg-gray-200 dark:bg-gray-600">
                        <span class="place-details-toggle-dot pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow-sm ring-0 transition-transform duration-200 translate-x-0.5" aria-hidden="true"></span>
                    </button>
                </div>

                <div class="relative group">
                    <input type="file" id="timeline-file-input" accept=".json"
                        class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                    <div
                        class="bg-blue-600 text-white rounded-xl px-6 py-4 font-semibold shadow-lg group-hover:bg-blue-700 transition-colors flex items-center justify-center gap-2">
                        <span>Select File</span>
                    </div>
                </div>
                <button id="demo-button"
                    class="mt-4 w-full rounded-xl px-6 py-3 font-semibold text-blue-600 bg-white/80 hover:bg-white border border-blue-100 shadow-sm transition-colors">
                    Try a demo
                </button>
                <div id="upload-status" class="mt-4 text-sm font-medium text-gray-600 dark:text-gray-300 min-h-[20px]"></div>
            </div>
            <div id="how-to-timeline" class="mt-8 text-left glass rounded-3xl p-6 shadow-lg">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">How to get Google Timeline data</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-gray-600 dark:text-gray-300">
                    <div>
                        <p class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Android</p>
                        <ol class="space-y-2">
                            <li>Open the Settings app on your device.</li>
                            <li>Tap Location &gt; Location Services &gt; Timeline.</li>
                            <li>Tap Export Timeline data.</li>
                            <li>Select a file location (Google Drive or local folder) and tap Save.</li>
                            <li>Wait for the export notification, then upload the file here.</li>
                        </ol>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800 dark:text-gray-200 mb-2">iOS</p>
                        <ol class="space-y-2">
                            <li>Open Google Maps and tap your profile picture.</li>
                            <li>Tap Settings, then Personal Content.</li>
                            <li>Under Location settings, tap Export Timeline data.</li>
                            <li>On the share sheet, choose Save to Files.</li>
                            <li>Upload the exported file (location-history.json) here.</li>
                        </ol>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Dashboard (Hidden by default) -->
        <div id="dashboard-content" class="hidden pb-12">

            <!-- ========== TYPOGRAPHY-FIRST STORYTELLING SECTIONS ========== -->

            <!-- Distance Story -->
            <section class="story-section min-h-[50vh] flex items-center justify-center py-16 opacity-0 scroll-trigger" id="story-distance">
                <div class="text-center max-w-4xl mx-auto px-4">
                    <p class="text-lg text-gray-600 dark:text-gray-300 mb-4 uppercase tracking-widest font-medium">Total Distance</p>
                    <h2 class="story-headline text-6xl md:text-8xl font-black text-gray-900 dark:text-white leading-none mb-6" id="stat-distance">
                        0 km
                    </h2>
                    <p class="text-xl md:text-2xl text-gray-600 dark:text-gray-300 font-light" id="stat-distance-subtitle">
                        You've been on quite the journey.
                    </p>
                </div>
            </section>

            <!-- Places & Countries Story -->
            <section class="story-section min-h-[50vh] flex items-center justify-center py-16 opacity-0 scroll-trigger" id="story-places">
                <div class="text-center max-w-4xl mx-auto px-4">
                    <p class="text-lg text-gray-600 dark:text-gray-300 mb-4 uppercase tracking-widest font-medium">Exploration</p>
                    <h2 class="story-headline text-5xl md:text-7xl font-black text-gray-900 dark:text-white leading-tight mb-6" id="stat-places">
                        <span id="stat-places-count">0</span> unique places
                    </h2>
                    <p class="text-xl md:text-2xl text-gray-600 dark:text-gray-300 font-light" id="stat-countries-text">
                        across <span class="font-bold text-blue-600 dark:text-blue-400" id="stat-countries-count">0</span> countries
                    </p>
                </div>
            </section>

            <!-- Total Visits Story -->
            <section class="story-section min-h-[40vh] flex items-center justify-center py-16 opacity-0 scroll-trigger" id="story-visits">
                <div class="text-center max-w-4xl mx-auto px-4">
                    <p class="text-lg text-gray-600 dark:text-gray-300 mb-4 uppercase tracking-widest font-medium">Check-ins</p>
                    <h2 class="story-headline text-6xl md:text-8xl font-black text-gray-900 dark:text-white leading-none mb-6" id="stat-visits">
                        0
                    </h2>
                    <p class="text-xl md:text-2xl text-gray-600 dark:text-gray-300 font-light">
                        total visits recorded
                    </p>
                </div>
            </section>

            <!-- Time Distribution Story -->
            <section class="story-section min-h-[50vh] flex items-center justify-center py-16 opacity-0 scroll-trigger" id="story-time">
                <div class="text-center max-w-4xl mx-auto px-4">
                    <p class="text-lg text-gray-600 dark:text-gray-300 mb-4 uppercase tracking-widest font-medium">Time Spent</p>
                    <div class="flex flex-col md:flex-row items-center justify-center gap-8 md:gap-16">
                        <div class="text-center">
                            <h2 class="story-headline text-5xl md:text-7xl font-black text-emerald-600 dark:text-emerald-400 leading-none" id="stat-time-moving">
                                0
                            </h2>
                            <p class="text-lg text-emerald-600/70 dark:text-emerald-400/70 font-medium" id="stat-time-moving-unit">days</p>
                            <p class="text-base text-gray-600 dark:text-gray-300 mt-1">on the move</p>
                        </div>
                        <div class="text-gray-300 dark:text-gray-600 text-4xl font-extralight hidden md:block">|</div>
                        <div class="text-center">
                            <h2 class="story-headline text-5xl md:text-7xl font-black text-indigo-600 dark:text-indigo-400 leading-none" id="stat-time-stationary">
                                0
                            </h2>
                            <p class="text-lg text-indigo-600/70 dark:text-indigo-400/70 font-medium" id="stat-time-stationary-unit">days</p>
                            <p class="text-base text-gray-600 dark:text-gray-300 mt-1">resting</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- How You Moved (Transport Breakdown) Story -->
            <section class="story-section min-h-[60vh] flex items-center justify-center py-16 opacity-0 scroll-trigger" id="story-transport">
                <div class="text-center max-w-5xl mx-auto px-4">
                    <p class="text-lg text-gray-600 dark:text-gray-300 mb-8 uppercase tracking-widest font-medium">How You Moved</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="stat-transport-grid">
                        <!-- Transport items will be dynamically added here -->
                    </div>
                </div>
            </section>

            <!-- Top Places Story -->
            <section class="story-section min-h-[60vh] flex items-center justify-center py-16 opacity-0 scroll-trigger" id="story-top-places">
                <div class="text-center max-w-5xl mx-auto px-4">
                    <p class="text-lg text-gray-600 dark:text-gray-300 mb-8 uppercase tracking-widest font-medium">Your Favorite Spots</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="stat-top-places-grid">
                        <!-- Top places will be dynamically added here -->
                    </div>
                </div>
            </section>

            <!-- Records Story -->
            <section class="story-section min-h-[50vh] flex items-center justify-center py-16 opacity-0 scroll-trigger" id="story-records">
                <div class="text-center max-w-4xl mx-auto px-4">
                    <p class="text-lg text-gray-600 dark:text-gray-300 mb-8 uppercase tracking-widest font-medium">Personal Records</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-300 uppercase tracking-wider mb-2">Longest Drive</p>
                            <h3 class="text-4xl md:text-5xl font-black text-gray-900 dark:text-white" id="stat-longest-drive">0 km</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2" id="stat-longest-drive-date"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-300 uppercase tracking-wider mb-2">Longest Walk</p>
                            <h3 class="text-4xl md:text-5xl font-black text-gray-900 dark:text-white" id="stat-longest-walk">0 km</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2" id="stat-longest-walk-date"></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Eco Impact Story -->
            <section class="story-section min-h-[50vh] flex items-center justify-center py-16 opacity-0 scroll-trigger" id="story-eco">
                <div class="text-center max-w-4xl mx-auto px-4">
                    <p class="text-lg text-green-600 dark:text-green-400 mb-4 uppercase tracking-widest font-medium">Emissions Saved</p>
                    <h2 class="story-headline text-5xl md:text-7xl font-black text-gray-900 dark:text-white leading-tight mb-6" id="stat-eco-co2">
                        0 kg COâ‚‚ saved
                    </h2>
                    <p class="text-xl md:text-2xl text-gray-600 dark:text-gray-300 font-light" id="stat-eco-trees">
                        Equivalent to <span class="font-bold text-green-600 dark:text-green-400" id="stat-trees-count">0</span> trees absorbing COâ‚‚ for a year
                    </p>
                </div>
            </section>

            <!-- Travel Summary (Text stats) -->
            <section class="my-24 opacity-0 scroll-trigger" id="travel-summary-card">
                <div class="max-w-4xl mx-auto px-4 text-left">
                    <h3 class="text-2xl font-bold mb-6 text-gray-900 dark:text-white">Travel Summary</h3>
                    <div class="space-y-3 text-sm text-gray-600 dark:text-gray-300">
                        <div class="flex items-baseline gap-2">
                            <span id="world-percentage"
                                class="text-lg font-semibold text-gray-900 dark:text-white">0.0</span>
                            <span id="world-percentage-label"
                                class="uppercase tracking-wide text-xs text-gray-600 dark:text-gray-300">Trips Around Earth</span>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed mt-1" id="travel-description">
                            Analysis pending...
                        </p>
                    </div>
                </div>
            </section>

            <!-- All Time Stats Footer (Hidden; data source only) -->
            <section class="hidden mt-16 bg-gray-900 rounded-3xl p-12 text-white shadow-2xl relative overflow-hidden opacity-0 scroll-trigger"
                id="all-time-card" aria-hidden="true">
                <div class="relative z-10 text-center">
                    <p class="text-sm text-gray-300 uppercase tracking-widest mb-4">All-Time</p>
                    <h2 class="text-4xl md:text-5xl font-bold mb-12">Lifetime Stats</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-8 md:gap-16" id="all-time-stats">
                        <!-- Content populated by JS -->
                    </div>
                </div>
            </section>

            <!-- All-time stats (text above globe) -->
            <div id="all-time-foreground-text" class="all-time-foreground-text text-gray-900 dark:text-white relative z-20">
                <h3 class="text-2xl font-bold mb-6">Lifetime Stats</h3>
                <div class="space-y-3 text-sm text-gray-600 dark:text-gray-300">
                    <div class="flex items-baseline gap-2">
                        <span id="all-time-distance" class="text-lg font-semibold text-gray-900 dark:text-white">0 km</span>
                        <span class="uppercase tracking-wide text-xs text-gray-600 dark:text-gray-300">Total Distance</span>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span id="all-time-visits" class="text-lg font-semibold text-gray-900 dark:text-white">0</span>
                        <span class="uppercase tracking-wide text-xs text-gray-600 dark:text-gray-300">Total Visits</span>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span id="all-time-countries" class="text-lg font-semibold text-gray-900 dark:text-white">0</span>
                        <span class="uppercase tracking-wide text-xs text-gray-600 dark:text-gray-300">Countries</span>
                    </div>
                </div>
                <div id="globe-map-hint" class="mt-6 text-sm text-gray-600 dark:text-gray-300 opacity-0 transition-opacity duration-300">
                    Click the globe to open the map
                </div>
            </div>

            <!-- Globe to Map Reveal Section -->
            <section id="globe-map-reveal" class="relative min-h-[120vh] mt-16">
                <div class="sticky top-0 h-screen flex items-center justify-center overflow-hidden"></div>
            </section>

            <!-- Map Overlay (opened on globe click) -->
            <section id="map-overlay" class="hidden fixed inset-0 z-40 p-6 bg-black/40 backdrop-blur-sm">
                <div class="w-full h-full flex items-center justify-center">
                    <section class="map-overlay-card glass dark:glass-dark rounded-3xl shadow-lg border border-white/50 dark:border-gray-700/50 overflow-hidden w-full h-full max-w-6xl relative">
                        <button id="map-overlay-close"
                            class="glow-blue-btn absolute top-3 right-3 z-[2000] w-9 h-9 rounded-full shadow-sm transition-colors flex items-center justify-center border"
                            title="Close map">
                            <span class="material-icons-round text-base">close</span>
                        </button>
                        <div id="map-container-wrapper" class="relative bg-gray-100 dark:bg-gray-800 w-full h-full transition-colors duration-300">
                            <div id="map" class="w-full h-full"></div>
                            <div id="map-markers-cap-message" class="hidden absolute bottom-3 left-1/2 -translate-x-1/2 z-[1000] px-3 py-1.5 rounded-lg bg-black/70 text-white text-xs" aria-live="polite"></div>
                        </div>
                    </section>
                </div>
            </section>


            <!-- Hidden containers for backward compatibility (JS still references these) -->
            <div id="statistics-grid" class="hidden"></div>
            <div id="travel-trends-grid" class="hidden"></div>
            <div id="visit-trends-grid" class="hidden"></div>
            <div id="time-distribution-stats" class="hidden"></div>
            <div id="record-breakers-stats" class="hidden"></div>
            <div id="eco-impact-grid" class="hidden"></div>
            <div id="cities-grid" class="hidden"></div>
            <div id="places-grid" class="hidden"></div>

        </div>

    </main>

    <!-- Share Dialog -->
    <section id="share-dialog" class="hidden fixed inset-0 z-[400] bg-black/40 backdrop-blur-sm">
        <div class="w-full h-full flex items-center justify-center p-6">
            <div class="glass dark:glass-dark rounded-2xl p-6 shadow-lg border border-white/50 dark:border-gray-700/50 w-full max-w-sm">
                <div class="flex items-start justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Share recap</h3>
                    <button id="share-dialog-close"
                        class="glow-blue-btn w-8 h-8 rounded-full shadow-sm transition-colors flex items-center justify-center border"
                        title="Close">
                        <span class="material-icons-round text-sm">close</span>
                    </button>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-300 mb-5">
                    What would you like to include on the share image?
                </p>
                <div class="space-y-3">
                    <button id="share-overall"
                        class="w-full rounded-xl px-4 py-3 bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-colors">
                        Overall details
                    </button>
                    <button id="share-year"
                        class="w-full rounded-xl px-4 py-3 bg-white/90 text-[#166fe3] font-semibold hover:bg-white transition-colors border border-white/60 dark:bg-slate-100 dark:text-[#166fe3] dark:hover:bg-gray-500 dark:border-gray-500">
                        Current year details
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Vercel Web Analytics (only on production; skip on localhost to avoid console noise) -->
    <script>
      window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script>
      (function () {
        if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') return;
        var a = document.createElement('script');
        a.src = '/_vercel/insights/script.js';
        a.defer = true;
        a.onerror = function () { /* blocked by client (e.g. ad blocker) â€“ ignore */ };
        document.body.appendChild(a);
      })();
    </script>

    <!-- Vercel Speed Insights (only on production; skip on localhost to avoid console noise) -->
    <script>
      window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };
    </script>
    <script>
      (function () {
        if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') return;
        var s = document.createElement('script');
        s.src = '/_vercel/speed-insights/script.js';
        s.defer = true;
        s.onerror = function () { /* blocked by client (e.g. ad blocker) â€“ ignore */ };
        document.body.appendChild(s);
      })();
    </script>

    <!-- Scripts (d3, leaflet, rbush, html-to-image, globe.js loaded on demand by script.js) -->
    <script src="config.js"></script>
    <script src="geodata-cache.js"></script>
    <script src="timeline-utils.js"></script>
    <script src="script.js"></script>
</body>

</html>